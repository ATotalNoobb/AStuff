_G.Staff = _G.Staff or {}
getgenv().Staff = getgenv().Staff or {}

local plr = game.Players.LocalPlayer
local char = plr.Character or plr.CharacterAdded:Wait()
local hand = char:FindFirstChild("RightHand") or char:FindFirstChild("Right Arm")

if not hand then return end

local parts = {}
local cfg = {count = 17, width = 0.35, height = 0.4}

for i = 1, cfg.count do
    local seg = Instance.new("Part")
    seg.Size = Vector3.new(cfg.width, cfg.height, cfg.height)
    seg.Material = Enum.Material.Metal
    seg.Color = Color3.fromRGB(255, 215, 0)
    seg.CanCollide, seg.CanTouch, seg.CanQuery = false, false, false
    seg.Anchored, seg.Massless = false, true
    seg.Parent = char
    
    local emit = Instance.new("ParticleEmitter")
    emit.Texture = "rbxassetid://35253286"
    emit.Color = ColorSequence.new(Color3.fromRGB(170, 0, 255))
    emit.LightEmission, emit.Rate = 1, 50
    emit.Lifetime = NumberRange.new(0.3, 0.7)
    emit.Speed = NumberRange.new(3, 7)
    emit.Rotation = NumberRange.new(0, 360)
    emit.RotSpeed = NumberRange.new(-100, 100)
    emit.Transparency = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0.2),
        NumberSequenceKeypoint.new(0.5, 0.4),
        NumberSequenceKeypoint.new(1, 1)
    })
    emit.Size = NumberSequence.new({
        NumberSequenceKeypoint.new(0, 0.1),
        NumberSequenceKeypoint.new(0.3, 0.4),
        NumberSequenceKeypoint.new(0.7, 0.3),
        NumberSequenceKeypoint.new(1, 0.1)
    })
    emit.Parent = seg
    
    parts[i] = seg
end

local mid = parts[math.ceil(cfg.count / 2)]
local motor = Instance.new("Motor6D")
motor.Name, motor.Part0, motor.Part1 = "StaffMotor", hand, mid
motor.C0 = CFrame.new(0, 0, -0.2) * CFrame.Angles(0, 0, math.rad(90))
motor.Parent = hand

for i = 2, #parts do
    local weld = Instance.new("Motor6D")
    weld.Part0, weld.Part1 = parts[i - 1], parts[i]
    weld.C0 = CFrame.new(cfg.width, 0, 0)
    weld.Parent = parts[i - 1]
    parts[i].CFrame = parts[i - 1].CFrame * weld.C0
end

_G.Staff = {Motor = motor, Parts = parts}
getgenv().Staff = _G.Staff
